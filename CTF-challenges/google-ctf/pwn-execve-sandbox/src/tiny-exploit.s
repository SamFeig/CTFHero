; Copyright 2018 Google LLC
;
; Licensed under the Apache License, Version 2.0 (the "License");
; you may not use this file except in compliance with the License.
; You may obtain a copy of the License at
;
;     https://www.apache.org/licenses/LICENSE-2.0
;
; Unless required by applicable law or agreed to in writing, software
; distributed under the License is distributed on an "AS IS" BASIS,
; WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
; See the License for the specific language governing permissions and
; limitations under the License.

BITS 64
GLOBAL _start
SECTION .text
_start:
	;; mmap
	mov	rax, 9
	mov	rbx, 3
	mov	rbp, -1
	mov	rdi, 0x11000
	mov	rsi, 0x1000
	mov	rdx, 3
	mov	r8, -1
	mov	r9, 0
	mov	r10, 0x132
	syscall

	;; stack expansion
	mov	rsp, 0x10ff0
	mov	word [rsp], 0x1337

	;; execve
	mov	rdi, 0x10000
	mov	rax, 0x67616c662f2e
	mov	[rdi], rax
	mov	rax, 0x3b
	push	0
	mov	rdx, rsp
	push	rdi
	mov	rsi, rsp
	syscall

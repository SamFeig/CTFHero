// Copyright 2018 Google LLC
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//      http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.



var h="mov cmp jlz jgz jnz jez ret add sub mul div mod and orr xor not shl shr prt get".split(" ");function l(a){return a.match(/[&][a-z]+/ig).reduce(function(a,d){a[d]=d;return a},{})}function m(a){return Array.from(new Uint8Array((new Int32Array([a])).buffer))}function n(a){return String(a).split("").reduce(function(a,d){var c=d.charCodeAt();return a.concat([c&255,c>>8])},[])}function p(a){return[].concat.apply(m(a.length),n(a))}
function q(a){var c=1,d={},e="",g=1;String(a).replace(/^\s*([$][a-z]+)\s+(string|int|float|mem)\s+(.*)/img,function(a,k,u,f){var b=[];switch(u){case "string":b=[8].concat(p(f));break;case "int":b=[4].concat(m(f|0));break;case "float":b=[7].concat(Array.from(new Uint8Array((new Float64Array([Number(f)])).buffer)));break;case "mem":for(a=0;a<Number(f);a+=4)b.push(0,0,127,127);break;default:throw Error("Error parsing "+a);}f=4-b.length%4;for(a=0;a<f;a++)b.push([127]);d[k]=new Uint32Array([g++]);c+=b.length/
4;e+=escape(String.fromCharCode.apply(String,b))});return{code:a,offset:4*c,labels:d,a:e}}
function r(a,c){var d=l(a),e=[];for(b in d)c.labels[b]=new Uint32Array([0]);var g=0;String(a).replace(/^\s*(?:([&][a-z]+):|([a-z]{3})\s+(?:(int|float)?\s*(\S+))(?:\s*(?:(int|float|string)?\s*(.+))))/img,function(a,b,d,v,x,y,z){if(b)c.labels[b].set([c.offset/4+g]);else{b=function(a,b,d){switch(a){case "int":e.push([4],m(b));break;case "float":e.push([7],Array.from(new Uint8Array((new Float64Array([b])).buffer)));break;case "string":e.push([8],p(b));break;default:e.push([(d?128:0)+5],new Uint8Array(c.labels[b].buffer))}};
var k=h.indexOf(d);if(0>k)throw Error("Invalid instruction "+d+" in "+a);e.push([k]);b(v,x,!1);b(y,z,!0);g++}});var b=escape(String.fromCharCode.apply(String,[].concat.apply([],e.map(function(a){return Array.from(a)}))));return{code:a,data:c,labels:d,c:e,offset:g,a:b}}
function t(a){var c=a.replace(/\s*;.*/g,"");a=q(c.match(/(?:^|\n)[.]data\r?\n([\s\S]*)(?=\n[.]code\r?\n)/i)[1]);var c=r(c.match(/(?:^|\n)[.]code\r?\n([\s\S]*)/i)[1],a),d=[unescape(a.a),unescape(c.a)].join("").split("").map(function(a){return a.charCodeAt()});return{b:(new Uint8Array([].concat(Array.from(new Uint8Array((new Uint32Array([a.offset])).buffer)),Array.from(d),Array(5-d.length%4).join("0").split("")))).buffer,f:{data:a,code:c}}}_compile=function(a){return t(a).b};var w=_testcases;
_showUser=function(a){alert(a)};function A(a){self._showUser(a)}function B(a){this.message="Wrong answer on test "+a.test}B.prototype=Error.prototype;
var C=!location.href.match(/noworker/)&&self.Worker||function(a){var c=document.body.appendChild(document.createElement("iframe"));c.sandbox="allow-scripts";c.srcdoc='\n<meta http-equiv=content-security-policy content="default-src '+location.origin+"/js/ 'unsafe-eval' 'unsafe-inline'\">\n<script>function postMessage(d){parent.postMessage(d,'*')}\x3c/script>\n<script src=\""+a+'">\x3c/script>';var d=this,e=[];c.onload=function(){d.postMessage=function(a,b){c.contentWindow.postMessage(a,"*",b)};e.forEach(function(a){d.postMessage.apply(d,
a)})};window.addEventListener("message",function(a){if(a.source==c.contentWindow)try{d.onmessage(a)}catch(b){}},!1);this.postMessage=function(a,b){e.push([a,b])};this.terminate=function(){c.parentNode&&c.parentNode.removeChild(c)}};
_runTests=function(a,c,d){d=d||location.href.match(/debug/);history.replaceState(null,null,"/");console.log("Starting tests..");var e=w[a];return Promise.all(e.map(function(a){var b=new C("js/worker.min.js?"+d),e=c.slice(0);b.postMessage({stdin:a[0],program:e},[e]);return new Promise(function(c,d){b.onerror=function(a){d(a)};b.onmessage=function(e){e.data.answer==a[1]?c(e.data):d(new B(e.data));b.terminate()}})})).then(function(a){A("Your code is correct!");var b=a.reduce(function(a,b){return a+b.counters.cycles},
0);console.log(b,c.byteLength);if(b<20*e.length){if(400>c.byteLength)return A("Your answers:"+a.map(function(a){return a.answer}).join()),!0;A("Well done! Now make the code smaller.")}else A("Well done! Now make the code faster.")})["catch"](function(a){d&&console.error(a);A("Got one or more invalid test cases.")})};


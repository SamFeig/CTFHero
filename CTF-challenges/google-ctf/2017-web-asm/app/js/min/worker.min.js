// Copyright 2018 Google LLC
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//      http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.



var e="mov cmp jlz jgz jnz jez ret add sub mul div mod and orr xor not shl shr prt get".split(" ");function g(){}g.prototype=Error.prototype;var l="Int8 Uint8 Int16 Uint16 Int32 Uint32 Float32 Float64 _String".split(" ");
_StringArray=function(d,c,b){this.buffer=d;this.byteOffset=c||0;this.byteLength=b||d.byteLength-this.byteOffset;d=new DataView(d,c,b);for(b=0;b<d.byteLength;b+=4+2*c){c=d.getUint32(this.byteOffset,!0);try{this.push(String.fromCharCode.apply(String,Array.from(new Uint16Array(d.buffer.slice(this.byteOffset+b+4,this.byteOffset+b+4+2*c)))))}catch(f){break}}};_StringArray.prototype=[];
function m(d){var c=new Uint8Array(d),b=c[0]>>7,f=l[c[0]&127];if(f){var c=f.replace(/\D+/g,""),a;c&&(a=1+c/8);var h=new self[f+"Array"](d.slice(1,a));c||(c=32+16*h[0].length);b=b?function(a){return a[h[0]]}:h[0];d=new Uint8Array(d.slice(1+c/8));for(a=0;127===d[a];)a++;return{value:b,a:1+c/8+a}}throw new g;}function p(d,c){try{return p(d(c),c)}catch(b){return d}}function q(){}function r(){}function t(){}var u=[function(d){return q(d)},function(d){return r(d)},function(d){return t(d)}],v={};
function w(d){var c=new Uint8Array(d),c=e[c[0]],b=m(d.slice(1)),f=m(d.slice(1+b.a));d=1+b.a+f.a;switch(c){case "mov":c=function(a){a[p(b.value,a)]=p(f.value,a);return v};break;case "cmp":c=function(a){var c=a[p(b.value,a)],d=p(f.value,a);a[p(b.value,a)]=c===d;return v};break;case "jlz":c=function(a){return 0>p(f.value,a)?a[p(b.value,a)](a):v};break;case "jgz":c=function(a){return 0<p(f.value,a)?a[p(b.value,a)](a):v};break;case "jez":c=function(a){return 0===p(f.value,a)?a[p(b.value,a)](a):v};break;
case "jnz":c=function(a){return 0!==p(f.value,a)?a[p(b.value,a)](a):v};break;case "ret":c=function(a){return a[p(b.value,a)]};break;case "add":c=function(a){a[p(b.value,a)]+=p(f.value,a);return v};break;case "sub":c=function(a){a[p(b.value,a)]-=p(f.value,a);return v};break;case "mul":c=function(a){a[p(b.value,a)]*=p(f.value,a);return v};break;case "div":c=function(a){a[p(b.value,a)]/=p(f.value,a);return v};break;case "mod":c=function(a){a[p(b.value,a)]%=p(f.value,a);return v};break;case "and":c=function(a){a[p(b.value,
a)]&=p(f.value,a);return v};break;case "orr":c=function(a){a[p(b.value,a)]|=p(f.value,a);return v};break;case "xor":c=function(a){a[p(b.value,a)]^=p(f.value,a);return v};break;case "not":c=function(a){a[p(b.value,a)]=~p(f.value,a);return v};break;case "shl":c=function(a){a[p(b.value,a)]<<=p(f.value,a);return v};break;case "shr":c=function(a){a[p(b.value,a)]>>=p(f.value,a);return v};break;case "prt":c=function(a){u[p(b.value,a)](p(f.value,a));return v};break;case "get":c=function(a){a[p(b.value,a)]=
u[p(f.value,a)]();return v};break;default:throw new g;}return{value:c,a:d}}
function x(d,c){var b=Array.from(new Uint32Array(d)),f=b[0]/4,a=d.slice(4,b[0]);try{for(var h=1;h<f;h++){c.variables++;var k=m(a);a=a.slice(k.a);b[h]=k.value}}catch(y){}try{for(var n=d.slice(b[0]);;){c.instructions++;k=w(n);if(!k.value)break;n=n.slice(k.a);b[f++]=k.value}}catch(y){}for(b[f]=function(){return v};"function"===typeof b[f-1];f--)b[f-1]=function(a,b){return function(d){c.cycles++;var f=a(d);return f===v?b(d):f}}(b[f-1],b[f]);return b[f](b)}
self.onmessage=function(d){q=[].shift.bind(d.data.stdin.slice(0));r=t=function(b){-1<location.search.indexOf("debug")&&console.log(b)};var c={cycles:0};postMessage({answer:x(d.data.program,c),test:d.data.stdin,counters:c})};

